# üöÄ SignalR Meetup App - Backend

[![.NET](https://img.shields.io/badge/.NET-9.0-512BD4?logo=dotnet)](https://dotnet.microsoft.com/)
[![SignalR](https://img.shields.io/badge/SignalR-Real--time-00C7B7)](https://dotnet.microsoft.com/apps/aspnet/signalr)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

Backend moderno em **ASP.NET Core** com **SignalR** para demonstra√ß√£o de comunica√ß√£o em tempo real, incluindo rastreamento de ve√≠culos, chat multi-sala e notifica√ß√µes de pagamento.

---

## üìã √çndice

- [Sobre o Projeto](#-sobre-o-projeto)
- [Funcionalidades](#-funcionalidades)
- [Tecnologias](#-tecnologias)
- [Arquitetura](#-arquitetura)
- [Pr√©-requisitos](#-pr√©-requisitos)
- [Instala√ß√£o](#-instala√ß√£o)
- [Configura√ß√£o](#-configura√ß√£o)
- [Uso](#-uso)
- [Endpoints da API](#-endpoints-da-api)
- [Hubs do SignalR](#-hubs-do-signalr)
- [Autentica√ß√£o](#-autentica√ß√£o)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [Deploy](#-deploy)
- [Contribui√ß√£o](#-contribui√ß√£o)
- [Licen√ßa](#-licen√ßa)

---

## üéØ Sobre o Projeto

Este projeto foi desenvolvido como parte de um **Meetup sobre SignalR** e demonstra implementa√ß√µes pr√°ticas de comunica√ß√£o em tempo real usando ASP.NET Core. O backend oferece tr√™s casos de uso reais:

1. **üöó Rastreamento de Ve√≠culos**: Simula√ß√£o de GPS em tempo real com movimenta√ß√£o suave
2. **üí¨ Chat Multi-Sala**: Sistema de chat com m√∫ltiplas salas e gerenciamento de grupos
3. **üí≥ Notifica√ß√µes de Pagamento**: Processamento ass√≠ncrono com atualiza√ß√µes em tempo real

O projeto segue princ√≠pios de **Clean Architecture** e **SOLID**, separando responsabilidades entre Controllers, Services e Hubs.

---

## ‚ú® Funcionalidades

### üîê Autentica√ß√£o JWT
- Login com usu√°rios de demonstra√ß√£o
- Tokens JWT para autentica√ß√£o segura
- Valida√ß√£o de tokens em tempo real
- Suporte a autentica√ß√£o via query string (SignalR)

### üöó Rastreamento de Ve√≠culos (TrackingHub)
- Simula√ß√£o realista de movimento de ve√≠culo
- Interpola√ß√£o suave entre waypoints
- Dados detalhados: velocidade, dire√ß√£o, status
- Paradas em pontos de entrega
- Broadcast server-to-client autom√°tico

### üí¨ Chat em Tempo Real (ChatHub)
- M√∫ltiplas salas de chat
- Join/Leave de salas dinamicamente
- Notifica√ß√µes de entrada/sa√≠da de usu√°rios
- Mensagens com timestamp e identifica√ß√£o de usu√°rio
- Suporte a autentica√ß√£o obrigat√≥ria

### üí≥ Processamento de Pagamentos (PaymentHub)
- Simula√ß√£o de processamento ass√≠ncrono
- Notifica√ß√µes de status em tempo real
- Grupos privados por usu√°rio e pedido
- Estados: Pending ? Processing ? Completed/Failed
- Fire-and-forget pattern

---

## üõ†Ô∏è Tecnologias

- **[.NET 9.0](https://dotnet.microsoft.com/)** - Framework principal
- **[ASP.NET Core SignalR](https://dotnet.microsoft.com/apps/aspnet/signalr)** - Comunica√ß√£o em tempo real
- **[JWT Bearer Authentication](https://jwt.io/)** - Autentica√ß√£o e autoriza√ß√£o
- **[Swagger/OpenAPI](https://swagger.io/)** - Documenta√ß√£o da API
- **[Hosted Services](https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services)** - Background tasks

### Pacotes NuGet
```xml
<PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="9.0.10" />
<PackageReference Include="Microsoft.AspNetCore.OpenApi" Version="9.0.9" />
<PackageReference Include="Swashbuckle.AspNetCore" Version="9.0.6" />
```

---

## üèóÔ∏è Arquitetura

### Padr√µes Implementados

- **Clean Architecture**: Separa√ß√£o clara entre camadas
- **Dependency Injection**: Inje√ß√£o de depend√™ncias nativa do ASP.NET Core
- **Service Layer**: L√≥gica de neg√≥cio isolada em services
- **DTOs (Data Transfer Objects)**: Contratos de comunica√ß√£o entre camadas
- **Background Services**: Processamento ass√≠ncrono com `IHostedService`
- **Hub Pattern**: Thin Hubs focados apenas em comunica√ß√£o

### Fluxo de Dados

```
Client (Next.js/React)
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Controllers (HTTP REST)           ‚îÇ
‚îÇ   - AuthController                  ‚îÇ
‚îÇ   - PaymentsController              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Services (Business Logic)         ‚îÇ
‚îÇ   - IAuthService                    ‚îÇ
‚îÇ   - IPaymentService                 ‚îÇ
‚îÇ   - CarTrackingService              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   SignalR Hubs (Real-time)          ‚îÇ
‚îÇ   - TrackingHub                     ‚îÇ
‚îÇ   - ChatHub                         ‚îÇ
‚îÇ   - PaymentHub                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚Üì
Client (WebSocket Connection)
```

---

## üì¶ Pr√©-requisitos

- [.NET 9.0 SDK](https://dotnet.microsoft.com/download/dotnet/9.0) ou superior
- IDE recomendada:
  - [Visual Studio 2022](https://visualstudio.microsoft.com/) (17.8+)
  - [Visual Studio Code](https://code.visualstudio.com/) com extens√£o C#
  - [JetBrains Rider](https://www.jetbrains.com/rider/)
- [Git](https://git-scm.com/)

---

## üöÄ Instala√ß√£o

### 1. Clone o reposit√≥rio

```bash
git clone https://github.com/Marcus-Boni/SignalR-Meetup-App-Backend.git
cd SignalR-Meetup-App-Backend
```

### 2. Restaure as depend√™ncias

```bash
dotnet restore
```

### 3. Execute o projeto

```bash
dotnet run
```

O servidor estar√° dispon√≠vel em:
- **HTTPS**: `https://localhost:5001`
- **HTTP**: `http://localhost:5000`

---

## ‚öôÔ∏è Configura√ß√£o

### CORS

Para desenvolvimento local com frontend, ajuste a pol√≠tica CORS em `Program.cs`:

```csharp
builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowNextApp", policy =>
    {
        policy.WithOrigins(
                "http://localhost:3000",  // Next.js local
                "https://seu-app.vercel.app"  // Produ√ß√£o
              )
              .AllowAnyHeader()
              .AllowAnyMethod()
              .AllowCredentials();
    });
});
```

---

## üíª Uso

### 1. Autentica√ß√£o

Primeiro, obtenha um token JWT:

```bash
curl -X POST https://localhost:5001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin123"
  }'
```

**Usu√°rios de demonstra√ß√£o:**
- `admin` / `admin123`
- `usuario1` / `senha123`
- `usuario2` / `senha456`
- `teste` / `teste123`

**Resposta:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "username": "admin",
  "expiresAt": "2024-01-20T15:30:00Z"
}
```

### 2. Conectar ao SignalR (JavaScript)

```javascript
import * as signalR from "@microsoft/signalr";

const token = "seu-token-jwt";

// Conex√£o com autentica√ß√£o
const connection = new signalR.HubConnectionBuilder()
  .withUrl("https://localhost:5001/chatHub", {
    accessTokenFactory: () => token
  })
  .withAutomaticReconnect()
  .build();

// Conectar
await connection.start();
console.log("? Conectado ao SignalR");

// Entrar em uma sala
await connection.invoke("JoinRoom", "sala-geral");

// Receber mensagens
connection.on("ReceiveMessage", (message) => {
  console.log(`${message.user}: ${message.message}`);
});

// Enviar mensagem
await connection.invoke("SendMessage", "sala-geral", "Ol√°, pessoal!");
```

---

## üì° Endpoints da API

### Autentica√ß√£o

#### POST `/api/auth/login`
Autentica um usu√°rio e retorna um token JWT.

**Request Body:**
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**Response:**
```json
{
  "token": "eyJhbGc...",
  "username": "admin",
  "expiresAt": "2024-01-20T15:30:00Z"
}
```

#### GET `/api/auth/validate`
Valida um token JWT (requer autentica√ß√£o).

**Response:**
```json
{
  "isValid": true,
  "username": "admin",
  "userId": "1",
  "claims": [...]
}
```

#### GET `/api/auth/health`
Health check do servi√ßo de autentica√ß√£o.

---

### Pagamentos

#### POST `/api/payments/pay`
Inicia um pagamento ass√≠ncrono (requer autentica√ß√£o).

**Request Body:**
```json
{
  "orderId": "ORD-12345",
  "amount": 150.50,
  "description": "Compra de produtos"
}
```

**Response (202 Accepted):**
```json
{
  "orderId": "ORD-12345",
  "status": "Processing initiated",
  "message": "Seu pagamento foi recebido...",
  "timestamp": "2024-01-20T14:25:00Z"
}
```

> **Nota:** O status do pagamento ser√° enviado via SignalR (PaymentHub).

#### GET `/api/payments/health`
Health check do servi√ßo de pagamentos.

---

## üîå Hubs do SignalR

### TrackingHub (`/trackingHub`)

**Server-to-Client (Broadcast autom√°tico)**

| M√©todo | Par√¢metros | Descri√ß√£o |
|--------|-----------|-----------|
| `ReceivePosition` | `VehiclePosition` | Recebe posi√ß√£o atualizada do ve√≠culo a cada 50ms |

**VehiclePosition:**
```typescript
{
  x: number;
  y: number;
  speed: number;
  heading: number;
  status: "Moving" | "Stopped" | "Accelerating" | "Braking";
  timestamp: string;
  routeProgress: number; // 0-100
}
```

---

### ChatHub (`/chatHub`)

**Client-to-Server**

| M√©todo | Par√¢metros | Retorno | Descri√ß√£o |
|--------|-----------|---------|-----------|
| `JoinRoom` | `roomName: string` | `void` | Entra em uma sala de chat |
| `LeaveRoom` | `roomName: string` | `void` | Sai de uma sala de chat |
| `SendMessage` | `roomName: string, message: string` | `void` | Envia mensagem para a sala |

**Server-to-Client**

| M√©todo | Par√¢metros | Descri√ß√£o |
|--------|-----------|-----------|
| `ReceiveMessage` | `ChatMessageDto` | Recebe nova mensagem na sala |
| `UserJoined` | `{user, roomName, timestamp}` | Notifica entrada de usu√°rio |
| `UserLeft` | `{user, roomName, timestamp}` | Notifica sa√≠da de usu√°rio |

**ChatMessageDto:**
```typescript
{
  user: string;
  message: string;
  roomName: string;
  timestamp: string;
}
```

---

### PaymentHub (`/paymentHub`)

**Client-to-Server**

| M√©todo | Par√¢metros | Retorno | Descri√ß√£o |
|--------|-----------|---------|-----------|
| `SubscribeToPaymentStatus` | `orderId: string` | `void` | Inscreve-se para atualiza√ß√µes de pagamento |
| `UnsubscribeFromPaymentStatus` | `orderId: string` | `void` | Cancela inscri√ß√£o |

**Server-to-Client**

| M√©todo | Par√¢metros | Descri√ß√£o |
|--------|-----------|-----------|
| `SubscriptionConfirmed` | `{orderId, message, timestamp}` | Confirma inscri√ß√£o |
| `PaymentStatusUpdated` | `PaymentStatusDto` | Atualiza√ß√£o de status do pagamento |

**PaymentStatusDto:**
```typescript
{
  orderId: string;
  status: "Pending" | "Processing" | "Completed" | "Failed";
  message: string;
  timestamp: string;
}
```

---

## üîê Autentica√ß√£o

### Fluxo de Autentica√ß√£o JWT

1. Cliente faz login via `/api/auth/login`
2. Backend valida credenciais e retorna token JWT
3. Cliente armazena o token (localStorage/sessionStorage)
4. Para HTTP requests: adiciona header `Authorization: Bearer {token}`
5. Para SignalR: passa token via `accessTokenFactory` ou query string

### Autentica√ß√£o em SignalR

O projeto suporta dois m√©todos:

**1. Via Token Factory (Recomendado):**
```javascript
const connection = new signalR.HubConnectionBuilder()
  .withUrl("/chatHub", {
    accessTokenFactory: () => getStoredToken()
  })
  .build();
```

**2. Via Query String:**
```javascript
const connection = new signalR.HubConnectionBuilder()
  .withUrl(`/chatHub?access_token=${token}`)
  .build();
```

---

## üìÅ Estrutura do Projeto

```
Meetup-WebSocket/
‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îú‚îÄ‚îÄ AuthController.cs          # Endpoints de autentica√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ PaymentsController.cs      # Endpoints de pagamento
‚îú‚îÄ‚îÄ Hubs/
‚îÇ   ‚îú‚îÄ‚îÄ TrackingHub.cs            # Hub de rastreamento
‚îÇ   ‚îú‚îÄ‚îÄ ChatHub.cs                # Hub de chat
‚îÇ   ‚îî‚îÄ‚îÄ PaymentHub.cs             # Hub de pagamentos
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ IAuthService.cs           # Interface de autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ AuthService.cs            # Implementa√ß√£o de autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ IPaymentService.cs        # Interface de pagamento
‚îÇ   ‚îú‚îÄ‚îÄ PaymentService.cs         # L√≥gica de pagamento
‚îÇ   ‚îî‚îÄ‚îÄ CarTrackingService.cs     # Background service de rastreamento
‚îú‚îÄ‚îÄ Dtos/
‚îÇ   ‚îú‚îÄ‚îÄ LoginRequestDto.cs        # DTO de login
‚îÇ   ‚îú‚îÄ‚îÄ LoginResponseDto.cs       # DTO de resposta de login
‚îÇ   ‚îú‚îÄ‚îÄ ChatMessageDto.cs         # DTO de mensagem de chat
‚îÇ   ‚îú‚îÄ‚îÄ PaymentRequestDto.cs      # DTO de requisi√ß√£o de pagamento
‚îÇ   ‚îî‚îÄ‚îÄ PaymentStatusDto.cs       # DTO de status de pagamento
‚îú‚îÄ‚îÄ Properties/
‚îÇ   ‚îî‚îÄ‚îÄ launchSettings.json       # Configura√ß√µes de execu√ß√£o
‚îú‚îÄ‚îÄ appsettings.json              # Configura√ß√µes da aplica√ß√£o
‚îú‚îÄ‚îÄ appsettings.Development.json  # Configura√ß√µes de desenvolvimento
‚îú‚îÄ‚îÄ Program.cs                    # Ponto de entrada e configura√ß√£o
‚îî‚îÄ‚îÄ Meetup-WebSocket.csproj       # Arquivo de projeto
```

---

## ü§ù Contribui√ß√£o

Contribui√ß√µes s√£o bem-vindas! Siga os passos:

1. Fa√ßa um fork do projeto
2. Crie uma branch para sua feature (`git checkout -b feature/NovaFuncionalidade`)
3. Commit suas mudan√ßas (`git commit -m 'Adiciona nova funcionalidade'`)
4. Push para a branch (`git push origin feature/NovaFuncionalidade`)
5. Abra um Pull Request

### Padr√µes de C√≥digo

- Siga as conven√ß√µes do C# (.NET)
- Use `async/await` para opera√ß√µes ass√≠ncronas
- Adicione XML documentation comments em m√©todos p√∫blicos
- Escreva logs informativos para debugging
- Mantenha os Hubs "thin" (l√≥gica de neg√≥cio nos Services)

---

## üìù Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

---

## üìö Recursos Adicionais

- [Documenta√ß√£o oficial do SignalR](https://learn.microsoft.com/en-us/aspnet/core/signalr/)
- [JWT Authentication no ASP.NET Core](https://learn.microsoft.com/en-us/aspnet/core/security/authentication/)
- [Background Services](https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services)
- [CORS no ASP.NET Core](https://learn.microsoft.com/en-us/aspnet/core/security/cors)

---

<div align="center">

**‚≠ê Se este projeto foi √∫til, considere dar uma estrela!**

Made with ‚ù§Ô∏è and .NET

</div>

